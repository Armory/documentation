#!/bin/bash

cd "$(dirname "$0")"/..

if [ -z "${DOCKER_IMAGE}" ]; then
    echo "ERROR: Please run the 'arm build' command instead."
    exit 1
fi 

# Create the build container:
rm -dfr build || true
mkdir -p build
cat <<EOD > build/Dockerfile.hugo
FROM golang:1.7
RUN go get -u -v github.com/spf13/hugo
EOD
docker build -t local-hugo -f build/Dockerfile.hugo .
rm build/Dockerfile.hugo

# Build the site:
docker run \
    -v "$(pwd)"/src:/documentation/ \
    -v "$(pwd)"/build:/documentation/public \
    local-hugo bash -c \
    "cd /documentation/ && hugo"

# Create the run comtainer:
docker build -t "${DOCKER_IMAGE}" -f etc/Dockerfile .
